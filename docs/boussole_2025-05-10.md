# Boussole d’état – 10 mai 2025 (pivot « LangFlow → React‑Flow Builder »)

---

## 1. Point de départ & vision générale

| Élément | Contenu mis à jour |
| ------- | ------------------ |
|         |                    |

| **Objectif stratégique** | Construire un SaaS d’orchestration d’agents IA **100 % open‑source**, déployable **cloud → Docker local**, avec contrôle humain puis montée vers l’autonomie.                                                                                                                    |
| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Métaphore directrice** | **Maisons préfabriquées** côte‑à‑côte : chaque client possède sa maison (stack Docker) + un **atelier LEGO** intérieur (LangFlow) et une **table à dessin haut de gamme** (React‑Flow Builder).                                                                                  |
| **Environnement de dev** | Windows 10 (i7‑8750H, 16 Go RAM), Docker Desktop, GitHub monorepo.                                                                                                                                                                                                               |
| **Stack cœur**           | • **LangFlow** (catalogue de blocs/agents) • **React‑Flow Builder** (UI Next.js, branding, rôles) • **Compiler Service** (Jinja 2) • **LangGraph + CrewAI + Llama‑Index** • **ActivePieces CE** (déclencheur, pièce custom « RunAgentFlow ») • **Phoenix/OTEL** (observabilité). |
| **Pipeline magique**     | 1. Utilisateur dessine un flow (LangFlow **ou** React‑Flow Builder).2. **Save** → JSON envoyé à **/build**.3. Compiler Service génère/maj `app/flows/<slug>.py` + hot‑reload LangServe.4. ActivePieces déclenche `/run‑<slug>` via la Piece custom.                              |

---

## 2. Historique condensé des actions clés

| Date                  | Action                                                                  | Résultat                          |
| --------------------- | ----------------------------------------------------------------------- | --------------------------------- |
| 2025‑05‑08            | Stack ActivePieces 0.39 CE initiale                                     | UI OK (mono‑project).             |
| 2025‑05‑10            | **Pivot Scénario B** : 1 stack/client (maison préfab.)                  | Licence GPL respectée.            |
| 2025‑05‑11 aujouddhui | Ajout **LangFlow** + tests export JSON → Compiler → Phoenix             | Chaîne exécution validée.         |
| 2025‑05‑12            | Conception **React‑Flow Builder** (Next.js + Tailwind) & API `/catalog` | Catalogue dynamique opérationnel. |

---

## 3. Douleurs & raisons du nouveau pivot

| Problème                                              | Impact                                   | Solution « LangFlow → React‑Flow Builder »                                                              |
| ----------------------------------------------------- | ---------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| UI LangFlow non brandable, pas de rôle fin            | Look & feel hétéroclite chez les clients | Builder React‑Flow skinnable + IAM minimale (token)                                                     |
| Ajout d’un bloc = fork ou PR upstream LangFlow        | Friction, délais                         | Garder LangFlow comme **moteur & registry**, exposer directement le catalogue au Builder → plus de fork |
| ActivePieces génère des scripts : duplication logique | Complexité, maintenance double           | Nouvelle Piece **RunAgentFlow** → ActivePieces = déclencheur simple                                     |

---

## 4. Architecture cible (Scénario B v2)

```
monorepo/
  main/                <- toolbox, Compiler Service, LangFlow registry
  builder-front/       <- React-Flow Builder (Next.js)
  tenant/<slug>/       <- flows .json + .py générés pour le client
compose/<slug>/
  ├ activepieces:0.39-ce (31xx)
  ├ langserve (80xx)
  ├ phoenix  (14xx)
  ├ postgres, redis
  └ langflow  (78xx)   # interne, pas exposé public
```

**Flux**

1. **Client** ouvre React‑Flow Builder → récupère `/catalog` (LangFlow registry).
2. Dessine, clique **Save** → JSON → `/build`.
3. `Compiler Service` génère/maj `app/flows/<slug>.py`, hot‑reload.
4. Piece **RunAgentFlow** (ActivePieces) appelle `/run-<slug>`.
5. Phoenix trace spans.

---

## 5. Écart CE vs besoins & contournements

| Fonction manquante CE | Contournement                                    |
| --------------------- | ------------------------------------------------ |
| Multi‑project         | 1 compose = 1 client                             |
| RBAC UI               | Confiance interne + Builder gère un token simple |
| UI Pieces/Templates   | Ajout / mise à jour via rebuild de l’image       |

---

## 6. Documentation à mettre à jour

| Fichier                 | Action                                                                                   |
| ----------------------- | ---------------------------------------------------------------------------------------- |
| **activepieces\_4A.md** | Retirer section génération d’orchestration .py ; expliquer Piece RunAgentFlow.           |
| **workflows.md**        | Ajouter diagramme LangFlow → Builder → Compiler ; supprimer mention “Piece génératrice”. |
| *Legostudio*\*.md\*\*   | Remplacer immeuble LEGO par **maisons + atelier + table à dessin**.                      |
| **README**              | Pointer vers cette Boussole mise à jour.                                                 |

---

## 7. TODO technique court‑terme (3 semaines)

| Prio | Action                                                       | Commande clé (YAML)                                   |
| ---- | ------------------------------------------------------------ | ----------------------------------------------------- |
| 1    | **Installer LangFlow** dans stack modèle + tests export/run  | `docker compose up -d langflow`                       |
| 2    | **Créer Piece RunAgentFlow** (TS) + rebuild ActivePieces     | `pnpm run build && docker compose build activepieces` |
| 3    | **Route /catalog** dans Compiler Service                     | `uvicorn compiler_service.api:app`                    |
| 4    | **Skeleton React‑Flow Builder** (Next.js 14) + fetch catalog | `npm create next-app builder-front`                   |
| 5    | **Hot‑reload** LangServe via signals                         | incl. in Compiler Service                             |

---

## 8. Checklist opérationnelle (mise à jour)

*

---

## 9. Roadmap 6 semaines (révisée)

| Semaine | Livrable                                              | Image LEGO                       |
| ------- | ----------------------------------------------------- | -------------------------------- |
| 1       | LangFlow installé + tests unitaires RAG simple        | **Moteur monté sur châssis**     |
| 2       | Piece RunAgentFlow + premier flow déclenché           | **Interrupteur relié au moteur** |
| 3       | React‑Flow Builder MVP (catalogue & save)             | **Table à dessin personnalisée** |
| 4       | Flows RAG complexes + CrewAI (vote)                   | **Turbo & télémétrie**           |
| 5       | Edge‑agents locaux (scripts PC) exposés               | **Bras robotisé dans l’atelier** |
| 6       | Documentation complète + onboarding 1er client pilote | **Maison témoin décorée**        |

---

### Conclusion

Le nouveau cap : **LangFlow = moteur & catalogue**, **React‑Flow Builder = interface UX**. ActivePieces redevient un **déclencheur simple** grâce à la Piece RunAgentFlow. On progresse par incréments : installer → tester → builder UI → complexifier → edge‑agents.

> **Pivot validé.**
