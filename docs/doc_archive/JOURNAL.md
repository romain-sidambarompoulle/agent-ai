# JOURNAL.md ‚Äî Chronologie d√©taill√©e

> **Version¬†3 ‚Äì 10¬†mai¬†2025**
> Journal post‚Äëpivot Sc√©nario¬†B

## 2025-05-11 ‚Äì Reprise de la Phase 4A (stack demo)

| # | Action / D√©cision                        | Commande / Commit                                      | R√©sultat |
|---|------------------------------------------|--------------------------------------------------------|----------|
| 1 | **Pull LangFlow 1.1.4**                  | `docker compose pull langflow`                         | image 3.4 Go |
| 2 | Ajout LangFlow + OTEL dans compose/demo  | commit `c6e4d5e`                                       | ‚úîÔ∏è service :7860 |
| 3 | Cr√©ation mini-flow **hello_flow**        | UI LangFlow ‚Üí Export JSON                              | `flows/hello_flow.json` |
| 4 | Nettoyage cl√© API dans JSON              | `git grep -n "sk-"` ‚Üí removal                          | commit `9d360b2` |

---

## 2025-05-12 ‚Äì Finalisation 4A & outillage

| # | Action                                     | Commande / Commit                 | R√©sultat |
|---|--------------------------------------------|-----------------------------------|----------|
| 5 | **Variable OTEL** pour ActivePieces        | ajout `AP_OTEL_EXPORTER_OTLP_ENDPOINT` | traces visibles Phoenix |
| 6 | Script **create_tenant.ps1**               | commit `5b2b767`                  | clone stack ‚Üí `compose/<slug>` |
| 7 | D√©placement compose ‚Üí `compose/demo`       | commit `fbbf428`                  | arbo OK |
| 8 | Smoke-tests PowerShell (AP + LangFlow)     | `tests/smoke_4A.ps1`, commit `8eca70e` | retour 200 / 200 |
| 9 | Branding (v1) tentative + rollback         | image `activepieces-branded` puis retour officiel | couleur OK, logo √† refaire |
|10 | Ajout `.env` (ENCRYPTION / JWT)            | local only (git-ignored)          | conteneur healthy |
|11 | Journal & Boussole √† mettre √† jour         | **cette entr√©e**                  | ‚è≥ en cours |

---

> üîñ Toutes les op√©rations ci-dessus cl√¥turent la **Phase 4A** (stack ActivePieces CE + LangFlow, t√©l√©m√©trie, smoke-tests, script tenant).  
> Le branding sera repris plus tard ; passage imminent √† la **Phase 4B** (import LangFlow ‚Üí ActivePieces) ou au skin LangFlow, selon la priorit√© du jour.
---

## 2025‚Äë05‚Äë10 ‚Äì Pivot Sc√©nario¬†B <a id="Pivot_B"></a>

| D√©cision                                                         | Commande cl√©              | Statut |
| ---------------------------------------------------------------- | ------------------------- | ------ |
| 1 stack CE par client, abandon header X‚ÄëTenant, ajout Edge‚ÄëAgent | `create_tenant.ps1 ‚Äîhelp` | ‚úÖ      |
  1. **Stack isol√©e ActivePieces CE (4A)**                         |                           | en cours|
---

## Journal de d√©ploiement

### 08/05/2025 ‚Äì Phoenix

* **Probl√®me¬†:** crash √† cause des URLs doubl√©es (`http://http://‚Ä¶`)
* **Cause¬†:** variables d‚Äôenvironnement `PHOENIX_HOST`¬†/ `PHOENIX_COLLECTOR_ENDPOINT` superflues
* **Solution¬†:** suppression des deux variables dans `.env`
* **V√©rification¬†:** `curl.exe -I http://localhost:6006`¬†‚Üí HTTP/1.1¬†200¬†OK

---

## Journal de d√©ploiement¬†‚Äì **Phase¬†4A / ActivePieces**

> *Session unique¬†: 9¬†mai¬†2025¬†‚Äì d√©p√¥t **agent-ai***

### 1. Clone initial du sous‚Äëmodule **ActivePieces** (08/05/2025)

| #   | Action                          | Commande YAML                                                                                                  | R√©sultat                 |
| --- | ------------------------------- | -------------------------------------------------------------------------------------------------------------- | ------------------------ |
| 2‚Äë1 | **Se placer √† la racine**       | `cmd: cd C:\Users\Util\Desktop\agent-ai`<br>`path: ~`                                                          | ‚úîÔ∏è                       |
| 2‚Äë2 | Clone (URL erron√©e)             | `cmd: git submodule add https://github.com/activepieces/activepieces-core.git external/activepieces`           | ‚ùå *Repository not found* |
| 2‚Äë3 | Nettoyage tentative rat√©e       | `cmd: git submodule deinit -f external/activepieces ; git rm -rf external/activepieces`                        | ‚úîÔ∏è                       |
| 2‚Äë4 | **Ajout sous-module correct**   | `cmd: git submodule add https://github.com/activepieces/activepieces.git external/activepieces`                | ‚úîÔ∏è clone ‚âà¬†273¬†Mo        |
| 2‚Äë5 | Commit (par m√©garde sur `main`) | `cmd: git add .gitmodules external/activepieces && git commit -m "chore: add ActivePieces GPLv3 as submodule"` | ‚úîÔ∏è SHA `4dd995f`         |

### 2. Branche locataire cr√©√©e‚Ä¶ puis annul√©e

| #   | Action                                             | Commande                                                                                         | R√©sultat                                |
| --- | -------------------------------------------------- | ------------------------------------------------------------------------------------------------ | --------------------------------------- |
| B‚Äë1 | Stash WIP (docs + Docker)                          | `cmd: git stash push -m "wip: docs et docker avant r√©organisation"`                              | ‚úîÔ∏è                                      |
| B‚Äë2 | Cr√©ation **pr√©matur√©e** `tenant/demo-activepieces` | `cmd: git branch tenant/demo-activepieces`<br>`cmd: git push -u origin tenant/demo-activepieces` | ‚úîÔ∏è *(incoh√©rent vis‚Äë√†‚Äëvis Vision 360¬∞)* |
| B‚Äë3 | Alignement `main` ‚Üê origin                         | `cmd: git checkout main && git reset --hard origin/main`                                         | ‚úîÔ∏è                                      |
| B‚Äë4 | Retour branche locataire + pop stash               | `cmd: git checkout tenant/demo-activepieces && git stash pop`                                    | ‚úîÔ∏è                                      |

### 3. Validation sous‚Äëmodule

| #   | Action                   | Commande                                          | R√©sultat       |
| --- | ------------------------ | ------------------------------------------------- | -------------- |
| V‚Äë1 | Contr√¥le gitlink         | `cmd: git submodule status external/activepieces` | ‚úîÔ∏è `d0847488‚Ä¶` |
| V‚Äë2 | Init/update profondeur¬†1 | `cmd: git submodule update --init --depth 1`      | ‚úîÔ∏è             |

### 4. Nettoyage fichiers obsol√®tes

| #   | Action                    | Commande                                                                 | R√©sultat         |
| --- | ------------------------- | ------------------------------------------------------------------------ | ---------------- |
| N‚Äë1 | Suppression README racine | `cmd: git rm README.md && git commit -m "chore: remove obsolete README"` | ‚úîÔ∏è SHA `a294dfb` |
| N‚Äë2 | Push branche locataire    | `cmd: git push`                                                          | ‚úîÔ∏è               |

### 5. **R√©‚Äëalignement Git complet** (09/05/2025)

| #   | Action / D√©cision                            | Commande YAML                                                                                     | R√©sultat           |
| --- | -------------------------------------------- | ------------------------------------------------------------------------------------------------- | ------------------ |
| G‚Äë1 | Cherry‚Äëpick sous-module sur `main`           | `cmd: git cherry-pick 4dd995f`                                                                    | ‚úîÔ∏è SHA `23893f1`   |
| G‚Äë2 | Cherry‚Äëpick **infra Docker & docs**          | `cmd: git cherry-pick 19b2505`                                                                    | ‚úîÔ∏è SHA `1e71fc6`   |
| G‚Äë3 | Cherry‚Äëpick README removal                   | `cmd: git cherry-pick a294dfb`                                                                    | ‚úîÔ∏è                 |
| G‚Äë4 | Cherry‚Äëpick docs onboarding & multi‚Äëtenant   | `cmd: git cherry-pick 40eac5e`                                                                    | ‚úîÔ∏è                 |
| G‚Äë5 | Push `main` r√©align√©                         | `cmd: git push origin main`                                                                       | GitHub ‚Üê `105b760` |
| G‚Äë6 | **Suppression branche locataire pr√©matur√©e** | `cmd: git branch -D tenant/demo-activepieces`<br>`cmd: git push origin :tenant/demo-activepieces` | ‚úîÔ∏è                 |
| G‚Äë7 | Contr√¥le final                               | `cmd: git branch -a`                                                                              | Liste = `* main`   |

> **Bilan** : le d√©p√¥t est de nouveau conforme √† la Vision 360¬∞ ‚Äì aucune branche locataire fant√¥me.

### 6. Pr√©‚Äëcommit *infra* (Docker & docs) ‚Äî 09/05/2025

| #   | Action                             | Commande YAML                                                                         | R√©sultat         |
| --- | ---------------------------------- | ------------------------------------------------------------------------------------- | ---------------- |
| P‚Äë1 | Staging Docker & docs              | `git add .dockerignore .gitignore Dockerfile docker-compose.yml docs/ Dockerfile.app` | ‚úîÔ∏è               |
| P‚Äë2 | Commit "infra: base Docker & docs" | `git commit -m "infra: base Docker & docs"`                                           | ‚úîÔ∏è SHA `78dfbdf` |

### 7. Mise √† jour `docker-compose.yml` + build images

| #   | Action                                       | Commande                      | R√©sultat |
| --- | -------------------------------------------- | ----------------------------- | -------- |
| 4‚Äë1 | Ajout Postgres / Redis / ActivePieces (mono) | √©dition compose               | ‚úîÔ∏è       |
| 4‚Äë2 | Uniformisation restart policy                | ‚Äî                             | ‚úîÔ∏è       |
| 4‚Äë3 | Pull images distantes                        | `docker compose pull`         | ‚úîÔ∏è       |
| 4‚Äë4 | Build LangServe server                       | `docker compose build server` | ‚úîÔ∏è       |

### 8. D√©marrage stack compl√®te & tests

| #   | Action                    | Commande / V√©rif          | R√©sultat        |
| --- | ------------------------- | ------------------------- | --------------- |
| 5‚Äë1 | Lancement stack           | `docker compose up -d`    | ‚úîÔ∏è              |
| 5‚Äë2 | Variables s√©curit√© (.env) | ajout 2√ó32 car            | ‚úîÔ∏è              |
| 5‚Äë3 | Acc√®s UI                  | `http://localhost:3000`   | ‚úîÔ∏è √©cran signup |
| 5‚Äë4 | Cr√©ation compte admin     | John Biche                | ‚úîÔ∏è              |
| 5‚Äë5 | **Constat limitation UI** | pas de cr√©ation workspace | üü°              |

### 9. Limitation ¬´¬†multi‚Äëlocataires¬†¬ª d√©tect√©e

* **Observation¬†:** banni√®re ¬´¬†Unlock¬†Projects¬†¬ª apparue.
* **Impact¬†:** impossibilit√© de cr√©er workspace dans CE¬†‚â•¬†0.28.
* **Pistes (A/B/C)** √©num√©r√©es (voir doc historique).
* **D√©cision finale¬†:** **pivot vers Sc√©nario¬†B (10¬†mai)** ‚Üí 1 stack CE par client (voir #Pivot\_B).

---

### Entr√©e \[OBSOLETE¬†‚Äì pivot¬†B] Sprint¬†4A (flags EE) <a id="obsolete_ee"></a>

*Sous‚Äëmodule EE, patch flags `manageProjectsEnabled = true` ‚Äì devenu caduc apr√®s pivot du 10¬†mai.*

---

## Le√ßons retenues

* **Phoenix first** avant tout test.
* **PowerShell only** sur Windows pour √©viter confusion `curl`/`Invoke-RestMethod`.
* **Stack par client**¬†: toujours op√©rer dans `compose/<slug>`.
* ADR pour tout hack temporaire.


## 2025-05-06 ‚Äì Sprint¬†3¬†ter¬†: Post‚Äëmortem Phoenix Tracing¬†#S3c\_phoenix <a id="2025-05-06--sprint3ter"></a>

*(R√©sum√© d√©taill√© de la session de d√©bogage Phoenix / OTEL, 7¬†h de travail).* ÓàÄciteÓàÇturn10file4ÓàÅ

| Date       | Action / D√©cision    | REX                                                                                |
| ---------- | -------------------- | ---------------------------------------------------------------------------------- |
| 2025‚Äë05‚Äë06 | **√âchec tracing CI** | Provider OTEL d√©j√† fix√© par Phoenix ‚áí aucun span enregistr√©.                       |
| 2025‚Äë05‚Äë06 | **Tentatives**       | Forcer `trace.set_tracer_provider`, d√©placer imports CrewAI, `@pytest.mark.xfail`‚Ä¶ |
| 2025‚Äë05‚Äë06 | **D√©cision**         | Marquer le test *xfail*¬†; lancer Phoenix **en dehors** de l‚Äôimage CI.              |
| 2025‚Äë05‚Äë06 | **Pins d√©pendances** | `litellm 1.38.5`, `crewai 0.118.0`, `arize-phoenix-otel 0.9.2`.                    |
| 2025‚Äë05‚Äë06 | **Docker local**     | `agent-ai:local`¬†3.5¬†Go, `/invoke` OK.                                             |

---

## 2025-05-05 ‚Äì Sprint¬†3¬†bis¬†: Consolidation Git¬†&¬†CI¬†#S3b\_ci <a id="2025-05-05--sprint3bis"></a>

| Date       | Action                     | D√©cision                                                              |
| ---------- | -------------------------- | --------------------------------------------------------------------- |
| 2025‚Äë05‚Äë05 | **Migrations d√©pendances** | Alignement LangChain & CrewAI; CI repasse au vert.                    |
| 2025‚Äë05‚Äë05 | **Nettoyage branches**     | Branches fusionn√©es ‚Üí supprim√©es locale + GitHub.                     |
| 2025‚Äë05‚Äë05 | **Audit Git**              | `git fsck` ‚Üí repo sain.                                               |
| 2025‚Äë05‚Äë05 | **R√®gle d‚Äôor**             | Une branche termin√©e + tests verts ‚áí merge dans **main** puis delete. |

---

## 2025-05-02 ‚Äì Sprint¬†3¬†: Impl√©mentation CrewAI¬†#S3\_crewai <a id="2025-05-02--sprint3"></a>

| Date       | Action                    | Commande / D√©tail                                    |
| ---------- | ------------------------- | ---------------------------------------------------- |
| 2025‚Äë05‚Äë02 | **Branch feat/s3-crewai** | `git checkout -b feat/s3-crewai`                     |
| 2025‚Äë05‚Äë02 | **Python¬†3.11**           | `py -3.11 -m venv .venv`                             |
| 2025‚Äë05‚Äë02 | **Install CrewAI 0.118**  | `pip install crewai==0.118.0 langchain-core>=0.1.12` |
| 2025‚Äë05‚Äë02 | **Squelette Crew**        | `app/crew.py`¬†: Analyste, R√©dacteur, V√©rificateur    |
| 2025‚Äë05‚Äë02 | **Tests verts**           | `pytest -q` ‚Üí 3 tests OK                             |

---

## 2025-05-02 ‚Äì Sprint¬†2¬†: Orchestration LangGraph¬†#S2\_graph <a id="2025-05-02--sprint2"></a>

| Date       | Action                       | Commande / D√©tail                     |
| ---------- | ---------------------------- | ------------------------------------- |
| 2025‚Äë05‚Äë02 | **Graph think‚Üívalidate‚Üíact** | `app/graph.py`                        |
| 2025‚Äë05‚Äë02 | **Runner**                   | `python -m app.agent_ai.graph_runner` |
| 2025‚Äë05‚Äë02 | **Image Docker sprint2**     | `docker build -t agent-ai:sprint2 .`  |

---

## 2025-05-02 ‚Äì Sprint¬†1¬†: M√©moire / Chroma¬†#S1\_chroma <a id="2025-05-02--sprint1"></a>

| Date       | Action                 | Commande / D√©tail                                       |
| ---------- | ---------------------- | ------------------------------------------------------- |
| 2025‚Äë05‚Äë01 | **Install Chroma**     | `pip install chromadb`                                  |
| 2025‚Äë05‚Äë01 | **Ajout m√©moire**      | `Chroma(collection_name="chat_memory")` dans `chain.py` |
| 2025‚Äë05‚Äë01 | **CI GitHub workflow** | `.github/workflows/ci.yml` + dummy `OPENAI_API_KEY`     |
| 2025‚Äë05‚Äë02 | **Fin Sprint¬†1**       | M√©moire vectorielle op√©rationnelle.                     |

---

## 2025-04-30 ‚Äì Sprint¬†0¬†: Setup LangServe¬†#S0\_setup <a id="2025-04-30--sprint0"></a>

| Date       | Action                      | Commande / D√©tail                                                        |
| ---------- | --------------------------- | ------------------------------------------------------------------------ |
| 2025‚Äë04‚Äë28 | **Pr√©‚Äërequis**              | `py --version`, `git --version`, `docker version`                        |
| 2025‚Äë04‚Äë28 | **Clone demo**              | `git clone https://github.com/langchain-ai/langserve-launch-example.git` |
| 2025‚Äë04‚Äë28 | **Install LangServe 0.3.1** | `pip install -e .`                                                       |
| 2025‚Äë04‚Äë30 | **Dockerisation**           | `docker build -t agent-ai .` ‚Üí `/invoke` 200¬†OK                          |
| 2025‚Äë04‚Äë30 | **Fin Sprint¬†0**            | Stack LangServe fonctionnelle local & Docker.                            |

---

## üìå¬†Le√ßons retenues (par sprint)

* **Phoenix first**¬†: d√©marrer Phoenix avant tout test multi‚Äëagents¬†; sinon tracers OTEL en double.¬†ÓàÄciteÓàÇturn10file4ÓàÅ
* **Tests API via PowerShell** uniquement tant que Swagger HS.¬†ÓàÄciteÓàÇturn10file17ÓàÅ
* **Branches termin√©es ‚áí merge + delete** : √©viter la dette Git.¬†ÓàÄciteÓàÇturn10file19ÓàÅ
* **Cl√© OpenAI factice en CI** pour pr√©server quota.¬†ÓàÄciteÓàÇturn10file6ÓàÅ
* **cmd pour arboresence du projet important pour context** & "$env:ChocolateyInstall\bin\tree.exe" -I "__pycache__|\.venv|\.venv_py313|\.git|docs|\.pytest_cache|\.egg-info|\.mypy_cache|\.vscode|\.idea|node_modules|dist|build" -L 5 -a > TREE.md

---

*üëâ¬†Tout ajout ou modification doit suivre cette structure‚ÄØ; merci de maintenir la coh√©rence pour garder le fil du projet intact.*
